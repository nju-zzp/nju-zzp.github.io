<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Kafka Start | River&#39;s BLOG</title>
<meta name="keywords" content="">
<meta name="description" content="kafka å…¥é—¨æŒ‡å—
1. kafka åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„
2. kafka å•æœºç¯å¢ƒæ­å»º ä¸ å¯åŠ¨">
<meta name="author" content="River">
<link rel="canonical" href="http://124.222.233.153/posts/tech/se/kafka-start/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.1daf73e1554b072225da652aa70423e50c557f664ef1cffeb43e526e1a26b8b8.css" integrity="sha256-Ha9z4VVLByIl2mUqpwQj5QxVf2ZO8c/&#43;tD5SbhomuLg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://124.222.233.153/icons/pixel-blue.JPG">
<link rel="icon" type="image/png" sizes="16x16" href="http://124.222.233.153/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://124.222.233.153/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://124.222.233.153/apple-touch-icon.png">
<link rel="mask-icon" href="http://124.222.233.153/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Kafka Start" />
<meta property="og:description" content="kafka å…¥é—¨æŒ‡å—
1. kafka åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„
2. kafka å•æœºç¯å¢ƒæ­å»º ä¸ å¯åŠ¨" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://124.222.233.153/posts/tech/se/kafka-start/" />
<meta property="og:image" content="http://124.222.233.153/images/kafka.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-07T23:33:20+08:00" />
<meta property="article:modified_time" content="2023-03-07T23:33:20+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://124.222.233.153/images/kafka.png" />
<meta name="twitter:title" content="Kafka Start"/>
<meta name="twitter:description" content="kafka å…¥é—¨æŒ‡å—
1. kafka åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„
2. kafka å•æœºç¯å¢ƒæ­å»º ä¸ å¯åŠ¨"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Essays",
      "item": "http://124.222.233.153/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ¤– Technology",
      "item": "http://124.222.233.153/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ğŸ§‘â€ğŸ’» Software Engineering",
      "item": "http://124.222.233.153/posts/tech/se/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Kafka Start",
      "item": "http://124.222.233.153/posts/tech/se/kafka-start/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Kafka Start",
  "name": "Kafka Start",
  "description": "kafka å…¥é—¨æŒ‡å— 1. kafka åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„ 2. kafka å•æœºç¯å¢ƒæ­å»º ä¸ å¯åŠ¨",
  "keywords": [
    ""
  ],
  "articleBody": "kafka å…¥é—¨æŒ‡å— 1. kafka åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„ 2. kafka å•æœºç¯å¢ƒæ­å»º ä¸ å¯åŠ¨ å‚è€ƒï¼š\nhttps://blog.csdn.net/CSDN877425287/article/details/108836682 https://www.cnblogs.com/qpf1/p/9161742.html æ‰©å±•ï¼ˆkafkaç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—ï¼‰:\nkafkaç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—\n2.1 ä¸‹è½½Kafkaå®‰è£…åŒ…ä¸Šä¼ æœåŠ¡å™¨ kafkaå®˜ç½‘\nscp æŒ‡ä»¤ä¸Šä¼ æœåŠ¡å™¨\ntar xzvf kafka_2.12-2.1.0.tgz -C /home/ubuntu/environments\n2.2 é…ç½®zookeeperé…ç½® æ— éœ€å•ç‹¬ä¸‹è½½ï¼Œå·²ç»é›†æˆ\nvim ./kafka_2.12-2.1.0/config/zookeeper.properties\nå¦‚æœkafkaå’Œzkæ˜¯å•èŠ‚ç‚¹è¿è¡Œçš„è¯ä½¿ç”¨kafkaçš„é»˜è®¤é…ç½®å³å¯\n#é›†ç¾¤é…ç½®-å•èŠ‚ç‚¹æ— éœ€é…ç½® server.1=192.168.0.187:2888:3888 server.2=192.168.0.188:2888:3888 server.3=192.168.0.189:2888:3888 dataDir zkæ•°æ®å­˜æ”¾ç›®å½•\ndataLogDir zkæ—¥å¿—å­˜æ”¾ç›®å½•\nclientPort å®¢æˆ·ç«¯è¿æ¥zkæœåŠ¡çš„ç«¯å£\ntickTime zkæœåŠ¡å™¨ä¹‹é—´æˆ–è€…å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”\ninitLimit å…è®¸followerï¼ˆç›¸å¯¹äºLeadererè¨€çš„ï¼Œå®¢æˆ·ç«¯ï¼‰è¿æ¥å¹¶åŒæ­¥åˆ°Leaderçš„åˆå§‹åŒ–è¿æ¥æ—¶é—´ï¼Œä»¥tickTimeä¸ºå•ä½ï¼Œå½“åˆå§‹åŒ–è¿æ¥æ—¶é—´è¶…è¿‡è¯¥å€¼ï¼Œåˆ™è¡¨ç¤ºè¿æ¥å¤±è´¥ã€‚\nsyncLimit LeaderäºFollowerä¹‹é—´å‘é€æ¶ˆæ¯æ—¶ï¼Œè¯·æ±‚å’Œç­”åº”æ—¶é—´é•¿åº¦ï¼Œå¦‚æœfollowåœ¨è®¾ç½®æ—¶é—´å†…ä¸èƒ½ä¸leaderé€šä¿¡ï¼Œé‚£ä¹ˆæ­¤followerå°†ä¼šè¢«ä¸¢å¼ƒ\nserver.1=192.168.0.187:2888:3888 2888æ˜¯followeräºleaderå‡ç¼“ä¿¡æ¯çš„ç«¯å£ï¼Œ3888å½“leaderäº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼Œ3888æ˜¯å½“leaderæŒ‚äº†æ—¶ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ˜¯æœåŠ¡å™¨äº’ç›¸é€šä¿¡çš„ç«¯å£\n2.3 é…ç½®kafkaé…ç½®ï¼ˆserverï¼‰ å¦‚æœkafkaå’Œzkæ˜¯å•èŠ‚ç‚¹è¿è¡Œçš„è¯ä½¿ç”¨kafkaçš„é»˜è®¤é…ç½®å³å¯\nå…³é”®ï¼š\nlog.dirså’Œzookeeper.connectã€‚å‰è€…æ˜¯æ—¥å¿—å­˜æ”¾æ–‡ä»¶å¤¹ï¼Œåè€…æ˜¯zookeeperè¿æ¥åœ°å€ï¼ˆç«¯å£å’ŒclientPortä¿æŒä¸€è‡´ï¼‰ã€‚\nlisteners advertised.listenersï¼ˆå¯¹å¤–å®£æ‰¬/æš´éœ²çš„åœ°å€å’Œç«¯å£ï¼Œæ¯”å¦‚å¯¹ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æš´éœ²ï¼‰ åœ¨å…¬å¸å†…ç½‘éƒ¨ç½² kafka é›†ç¾¤åªéœ€è¦ç”¨åˆ° listenersï¼Œå†…å¤–ç½‘éœ€è¦ä½œåŒºåˆ†æ—¶ æ‰éœ€è¦ç”¨åˆ°advertised.listenersã€‚\nadvertised_listeners ç›‘å¬å™¨ä¼šæ³¨å†Œåœ¨ zookeeper ä¸­ï¼›\nå½“æˆ‘ä»¬å¯¹ 172.17.0.10:9092 è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œkafka æœåŠ¡å™¨ä¼šé€šè¿‡ zookeeper ä¸­æ³¨å†Œçš„ç›‘å¬å™¨ï¼Œæ‰¾åˆ° INSIDE ç›‘å¬å™¨ï¼Œç„¶åé€šè¿‡ listeners ä¸­æ‰¾åˆ°å¯¹åº”çš„ é€šè®¯ ip å’Œ ç«¯å£ï¼›\nåŒç†ï¼Œå½“æˆ‘ä»¬å¯¹ \u003cå…¬ç½‘ ip\u003e:ç«¯å£ è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œkafka æœåŠ¡å™¨ä¼šé€šè¿‡ zookeeper ä¸­æ³¨å†Œçš„ç›‘å¬å™¨ï¼Œæ‰¾åˆ° OUTSIDE ç›‘å¬å™¨ï¼Œç„¶åé€šè¿‡ listeners ä¸­æ‰¾åˆ°å¯¹åº”çš„ é€šè®¯ ip å’Œ ç«¯å£ 172.17.0.10:9094ï¼›\næ€»ç»“ï¼šadvertised_listeners æ˜¯å¯¹å¤–æš´éœ²çš„æœåŠ¡ç«¯å£ï¼ŒçœŸæ­£å»ºç«‹è¿æ¥ç”¨çš„æ˜¯ listenersã€‚\nåªæœ‰å†…ç½‘ï¼Œæ¯”å¦‚åœ¨å…¬å¸æ­å»ºçš„ kafka é›†ç¾¤ï¼Œåªæœ‰å†…ç½‘ä¸­çš„æœåŠ¡å¯ä»¥ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è¦ç”¨ listeners å°±è¡Œã€‚ å†…å¤–ç½‘ï¼Œæ¯”å¦‚åœ¨ docker ä¸­æˆ–è€… åœ¨ç±»ä¼¼é˜¿é‡Œäº‘ä¸»æœºä¸Šéƒ¨ç½² kafka é›†ç¾¤ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ éœ€è¦ç”¨åˆ° advertised_listeners broker.id=0\tæ¯ä¸ªserveréœ€è¦å•ç‹¬é…ç½®broker.idå¦‚æœä¸é…ç½®ç³»ç»Ÿä¼šæŒ‡å®šé…ç½®ï¼Œéœ€è¦å’Œä¸Šä¸€æ­¥IDä¸€è‡´ listeners=PLAINTEST://ip:9092\tç›‘å¬åœ°å€ï¼Œæ ¼å¼PLAINTESTï¼š//ipï¼šç«¯å£ num.network.threads=3\tæ¥æ”¶å’Œå‘é€ç½‘ç»œä¿¡æ¯çš„çº¿ç¨‹æ•° num.io.threads=8\tæœåŠ¡å™¨ç”¨äºå¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ•°ï¼Œå…¶ä¸­å¯èƒ½åŒ…æ‹¬ç£ç›˜IO socket.send.buffer.bytes=102400\tå¥—æ¥å­—æœåŠ¡å™¨ä½¿ç”¨çš„å‘é€ç¼“å†²åŒºï¼ˆSO_SNDBUFï¼‰ socket.receive.buffer.bytes=102400\tå¥—æ¥å­—æœåŠ¡å™¨ä½¿ç”¨çš„æ¥æ”¶ç¼“å†²åŒºï¼ˆSO_RCVBUFï¼‰ socket.request.max.bytes=104857600\tå¥—æ¥å­—æœåŠ¡å™¨å°†æ¥æ”¶çš„è¯·æ±‚æœ€å¤§å¤§å°ï¼ˆé˜²æ­¢OOMï¼‰ log.dirs=/tmp/kafka-logs\tæ—¥å¿—æ–‡ä»¶ num.partitions=1\tpartitionsçš„æ•°é‡ num.recovery.threads.per.data.dir=1\tå¯åŠ¨æ—¶æ¢å¤æ—¥å¿—ï¼Œå…³é—­æ—¶åˆ·ç›˜æ—¥å¿—æ¯ä¸ªæ•°æ®ç›®å½•çš„çº¿ç¨‹çš„æ•°é‡ï¼Œé»˜è®¤1 offsets.topic.replication.factor=1\tåç§»é‡è¯é¢˜çš„å¤åˆ¶å› å­ï¼ˆè®¾ç½®æ›´é«˜ä¿è¯å¯ç”¨ï¼‰ï¼Œä¸ºä¿è¯æœ‰æ•ˆçš„çˆ¶å­ï¼Œåç§»é‡çš„å¤åˆ¶å› å­æ˜¯å¯é…ç½®çš„ï¼Œåœ¨åç§»è¯é¢˜çš„ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™å¯ç”¨borkerçš„æ•°é‡è‡³å°‘ä¸ºå¤åˆ¶å› å­çš„å¤§å°ï¼Œå¦åˆ™è¦ä¹ˆè¯é¢˜åˆ›å»ºå¤±è´¥ï¼Œè¦ä¹ˆå¤åˆ¶å› å­å–å¯ç”¨çš„æ•°é‡å’Œé…ç½®å¤åˆ¶å› å­å–æœ€å°å€¼ transaction.state.log.replication.factor=1 transaction.state.log.min.isr=1 log.retention.hours=168\tæ—¥å¿—æ–‡ä»¶åˆ é™¤ä¹‹å‰ä¿ç•™çš„æ—¶é—´ log.segment.bytes=1073741824\tå•ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°é»˜è®¤ä¸º1073741824 log.retention.check.interval.ms=300000\tæ£€æŸ¥æ—¥å¿—ç«¯ä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥æ ¹æ®ä¿ç•™ç­–ç•¥åˆ é™¤ä»–ä»¬çš„æ—¶é—´é³„æ¢¨ zookeeper.connect=zkip:2181\tzkä¸»æœºåœ°å€ï¼Œå¦‚æœæ˜¯zké›†ç¾¤ä»¥é€—å·åˆ†éš” zookeeper.connection.timeout.ms=6000\tè¿æ¥zkçš„è¶…æ—¶æ—¶é—´ group.initial.rebalance.delay.ms=0 2.4 åå°å¯åŠ¨zookeeperå¹¶æ£€éªŒæ˜¯å¦è¿è¡ŒæˆåŠŸ cd kafka_2.12-2.1.0/ nohup bin/zookeeper-server-start.sh config/zookeeper.properties \u0026 nohup bin/zookeeper-server-start.sh config/zookeeper.properties \u003e zookeeper-run.log 2\u003e\u00261 \u0026 echo conf | nc localhost 2181 echo stat | nc localhost 2181 2.5 åå°å¯åŠ¨kafka nohup bin/kafka-server-start.sh config/server.properties \u003e kafka-run.log 2\u003e\u00261 \u0026 2.6 åˆ›å»ºå¹¶æŸ¥çœ‹topic ubuntu$\u003e ./bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test Created topic \"test\". ubuntu$\u003e ./bin/kafka-topics.sh --zookeeper localhost:2181 --list test 3. JAVAå®ç° Kafka Producer 3.1 æ–¹å¼ä¸€ï¼škafka-clients APIå‚è€ƒï¼šhttps://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html\nç”Ÿäº§è€…è¯¦è§£ã€è¿›é˜¶å‚è€ƒï¼šhttps://www.jianshu.com/p/37ea14d1d4abï¼ˆä¸»è¦åŒ…å«ç”Ÿäº§è€…å‚æ•°é…ç½®ã€æ¶ˆæ¯åºåˆ—åŒ–ã€è‡ªå®šä¹‰åˆ†åŒºï¼‰\nå¼•å…¥kafka-clientsä¾èµ– org.apache.kafka kafka-clients 2.1.0 åˆ›å»ºç”Ÿäº§è€… KafkaProducer KafkaProducer API: https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html\nå‘ Kafka å†™å…¥æ¶ˆæ¯ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ‰3ä¸ªå¿…è¦å±æ€§ã€‚\nbootstrap.servers æŒ‡å®š broker çš„åœ°å€åˆ—è¡¨ï¼Œåœ°å€çš„æ ¼å¼ä¸º host:portã€‚ ä¸éœ€è¦åŒ…å«æ‰€æœ‰çš„ broker åœ°å€ï¼Œç”Ÿäº§è€…ä¼šé€šè¿‡ç»™å®šçš„ broker æŸ¥æ‰¾åˆ°å…¶ä»– broker çš„ä¿¡æ¯ã€‚å»ºè®®è‡³å°‘æä¾›ä¸¤ä¸ª broker çš„ä¿¡æ¯ï¼Œé˜²æ­¢å…¶ä¸­ä¸€ä¸ªå®•æœºã€‚ key.serializer Kafka å®¢æˆ·ç«¯é»˜è®¤æä¾›äº† ByteArraySerializerã€ StringSerializer å’Œ IntegerSerializerï¼Œå› æ­¤å¦‚æœä½¿ç”¨å¸¸è§çš„ Java å¯¹è±¡ç±»å‹ï¼Œä¸éœ€è¦å®ç°è‡ªå·±çš„åºåˆ—åŒ–å™¨ ã€‚å¦‚æœè¦è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼Œéœ€è¦å®ç° org.apache.kafka.common.serialization.Serializer æ¥å£ã€‚ éœ€è¦æ³¨æ„ï¼Œkey.serializer æ˜¯å¿…é¡»è®¾ç½®çš„ï¼Œå³ä½¿åªå‘é€å€¼ç±»å‹ã€‚ value.serializer ä¸ key.serializer ä¸€æ ·ï¼Œ value.serializer æŒ‡å®šçš„ç±»ä¼šå°†å€¼åºåˆ—åŒ–å‘é€ç»™ brokerã€‚ Properties kafkaProps = new Properties(); kafkaProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"kafka-broker-ip:9092\"); kafkaProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); kafkaProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); KafkaProducer producer = new KafkaProducer(kafkaProps); å‘é€æ¶ˆæ¯ å®ä¾‹åŒ–ç”Ÿäº§è€…å¯¹è±¡åï¼Œå°±å¯ä»¥å¼€å§‹é€æ¶ˆæ¯äº†ã€‚å‘é€æ¶ˆæ¯ä¸»è¦æœ‰ä»¥ä¸‹ 3 ç§æ–¹å¼ï¼š\nå‘é€å¹¶å¿˜è®°ï¼ˆfire-and-forgetï¼‰ æŠŠæ¶ˆæ¯å‘é€ç»™æœåŠ¡å™¨ï¼Œä¸å…³å¿ƒæ˜¯å¦æ­£å¸¸åˆ°è¾¾ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯ä¼šæ­£å¸¸åˆ°è¾¾ï¼Œå› ä¸º Kafka æ˜¯é«˜å¯ç”¨çš„ï¼Œè€Œä¸”ç”Ÿäº§è€…ä¼šè‡ªåŠ¨å°è¯•é‡å‘ã€‚ä¸è¿‡ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æœ‰æ—¶å€™ä¹Ÿä¼šä¸¢å¤±ä¸€äº›æ¶ˆæ¯ã€‚ åŒæ­¥å‘é€ï¼ˆasyncï¼‰ ä½¿ç”¨ send() æ–¹æ³•å‘é€æ¶ˆæ¯ï¼Œä¼šè¿”å›ä¸€ä¸ª Future å¯¹è±¡ï¼Œè°ƒç”¨ get() æ–¹æ³•é˜»å¡ç­‰å¾…è¿”å›ï¼Œè¿”å›ç»“æœçŸ¥é“æ˜¯å¦å‘é€æˆåŠŸã€‚ å¼‚æ­¥å‘é€ï¼ˆsyncï¼‰ï¼ˆæœ€ç®€å•æœ€å¸¸ç”¨ï¼‰ ä½¿ç”¨ send() æ–¹æ³•å¹¶æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ŒæœåŠ¡å™¨åœ¨è¿”å›å“åº”æ—¶è°ƒç”¨è¯¥å‡½æ•°ã€‚ æ ¸å¿ƒå¯¹è±¡ï¼š\næ¶ˆæ¯å¯¹è±¡ ProducerRecord : https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html æ¶ˆæ¯è®°å½•çš„å­˜å‚¨ä¿¡æ¯ RecordMetadataï¼š https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.htmlï¼ˆsend(...).get()è¿”å›å¯¹è±¡ï¼‰ ä¾‹å­ä½¿ç”¨äº†ScheduledExecutorServiveï¼ˆå³ScheduledThreadPoolï¼‰æ¥è¿›è¡Œå®šæ—¶ä»»åŠ¡\nScheduledExecutorService scheduledExecutor = Executors.newScheduledThreadPool(5); scheduledExecutor.scheduleAtFixedRate(() -\u003e { try { RecordMetadata recordMetadata = producer.send(new ProducerRecord(\"test\", \"time\", new Date().toString())).get(); System.out.println(\"Success: OFFSET-\"+recordMetadata.offset()); } catch (InterruptedException e) { System.out.println(\"ERROR\"); throw new RuntimeException(e); } catch (ExecutionException e) { System.out.println(\"ERROR\"); throw new RuntimeException(e); } }, 0, 2, TimeUnit.SECONDS); 4. JAVAå®ç° Kafka Consumer 4.1 æ–¹å¼ä¸€ï¼škafç™»å½•ï¼Œæ–‡ä»¶æäº¤åè‡ªåŠ¨é‡å‘½åï¼Œæ”¯æŒæ”¶é›†ä»»æ„æ ¼å¼æ–‡ä»¶ã€‚ æ­é…åšæœäº‘ka-clients\nAPI å‚è€ƒï¼šhttps://kafka.apache.org/33/javadoc/org/apache/kafka/clients/consumer/package-frame.html\næ¶ˆè´¹è€…è¯¦è§£ã€è¿›é˜¶å‚è€ƒï¼šhttps://www.jianshu.com/p/1f9e18e926f6ï¼ˆä¸»è¦åŒ…æ‹¬æ¶ˆè´¹è€…å‚æ•°é…ç½®\nå¼•å…¥kafka-clientsä¾èµ– org.apache.kafka kafka-clients 2.1.0 åˆ›å»ºæ¶ˆè´¹è€… KafkaConsumer KafkaConsumerå¯¹è±¡APIï¼šhttps://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/consumer/KafkaConsumer.html ConsumerConfig APIï¼šhttps://kafka.apache.org/33/javadoc/org/apache/kafka/clients/consumer/ConsumerConfig.html auto.offset.resetï¼šå½“ä¸å­˜åœ¨åˆå§‹åç§»é‡æˆ–æœåŠ¡å™¨ä¸Šä¸å†å­˜åœ¨å½“å‰åç§»é‡æ—¶ï¼Œæ­¤å±æ€§æ˜¯å¿…éœ€çš„ã€‚åªæœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼å¯ç”¨äºé‡ç½®åç§»å€¼ï¼š\nWhat to do when there is no initial offset in Kafka or if the current offset does not exist any more on the server (e.g. because that data has been deleted):\nearliest: automatically reset the offset to the earliest offsetlatest: automatically reset the offset to the latest offsetnone: throw exception to the consumer if no previous offset is found for the consumer\\'s groupanything else: throw exception to the consumer. æŒ‡å®šäº†æ¶ˆè´¹è€…åœ¨è¯»å–ä¸€ä¸ªæ²¡æœ‰åç§»é‡ï¼ˆoffsetï¼‰çš„åˆ†åŒºæˆ–è€…åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹ï¼ˆå› æ¶ˆè´¹è€…é•¿æ—¶é—´å¤±æ•ˆï¼ŒåŒ…å«åç§»é‡çš„è®°å½•å·²ç»è¿‡æ—¶äº•è¢«åˆ é™¤ï¼‰è¯¥ä½œä½•å¤„ç†ï¼Œé»˜è®¤å€¼æ˜¯ latestï¼Œè¡¨ç¤ºåœ¨ offset æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å°†ä»æœ€æ–°çš„è®°å½•å¼€å§‹è¯»å–æ•°æ®ï¼ˆåœ¨æ¶ˆè´¹è€…å¯åŠ¨ä¹‹åç”Ÿæˆçš„è®°å½•ï¼‰ã€‚\nProperties props = new Properties(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"124.222.233.153:9092\"); props.put(ConsumerConfig.GROUP_ID_CONFIG, \"191870267-0\"); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, \"earliest\"); props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, \"10\"); KafkaConsumer consumer = new KafkaConsumer(props); è®¢é˜…ä¸»é¢˜Topic consumer.subscribe(Collections.singleton(\"test\")); æ¶ˆè´¹è½®è¯¢ï¼ˆæ ¸å¿ƒï¼‰ æ¶ˆæ¯è½®è¯¢æ˜¯æ¶ˆè´¹è€…çš„æ ¸å¿ƒï¼Œé€šè¿‡è½®è¯¢å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚æ¶ˆæ¯è½®è¯¢ API ä¼šå¤„ç†æ‰€æœ‰çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬ç¾¤ç»„åè°ƒã€åˆ†åŒºå†å‡è¡¡ã€å‘é€å¿ƒè·³å’Œè·å–æ•°æ®ï¼Œå¼€å‘è€…åªéœ€è¦å¤„ç†ä»åˆ†åŒºè¿”å›çš„æ•°æ®ã€‚\nwhile (true) { ConsumerRecords records = consumer.poll(Duration.ofSeconds(5)); for(ConsumerRecord record : records) { System.out.println(\"{offset=\" + record.offset() + \" , key=\" + record.key() + \" , value=\" + record.value() + \" , timestamp=\" + record.timestamp() + \" }\"); } System.out.println(); } ",
  "wordCount" : "3444",
  "inLanguage": "en",
  "image":"http://124.222.233.153/images/kafka.png","datePublished": "2023-03-07T23:33:20+08:00",
  "dateModified": "2023-03-07T23:33:20+08:00",
  "author":[{
    "@type": "Person",
    "name": "River"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://124.222.233.153/posts/tech/se/kafka-start/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "River's BLOG",
    "logo": {
      "@type": "ImageObject",
      "url": "http://124.222.233.153/icons/pixel-blue.JPG"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://124.222.233.153/" accesskey="h" title="River&#39;s BLOG (Alt + H)">
                <img src="http://124.222.233.153/icons/pixel-blue.JPG" alt="" aria-label="logo"
                    height="35">River&#39;s BLOG</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://124.222.233.153/posts/" title="Essays">
                    <span>Essays</span>
                </a>
            </li>
            <li>
                <a href="http://124.222.233.153/archives/" title="Time">
                    <span>Time</span>
                </a>
            </li>
            <li>
                <a href="http://124.222.233.153/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://124.222.233.153/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://124.222.233.153/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://124.222.233.153/friends" title="Friends">
                    <span>Friends</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://124.222.233.153/">Home</a>&nbsp;Â»&nbsp;<a href="http://124.222.233.153/posts/">Essays</a>&nbsp;Â»&nbsp;<a href="http://124.222.233.153/posts/tech/">ğŸ¤– Technology</a>&nbsp;Â»&nbsp;<a href="http://124.222.233.153/posts/tech/se/">ğŸ§‘â€ğŸ’» Software Engineering</a></div>
    <h1 class="post-title">
      Kafka Start
    </h1>
    <div class="post-meta"><span title='2023-03-07 23:33:20 +0800 CST'>March 7, 2023</span>&nbsp;Â·&nbsp;River

</div>
  </header> 
<figure class="entry-cover1"><img loading="lazy" src="http://124.222.233.153/images/kafka.png" alt="">
        
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#kafka-%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97" aria-label="kafka å…¥é—¨æŒ‡å—">kafka å…¥é—¨æŒ‡å—</a><ul>
                            
                    <li>
                        <a href="#1-kafka-%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5%e4%b8%8e%e5%9f%ba%e6%9c%ac%e6%9e%b6%e6%9e%84" aria-label="1. kafka åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„">1. kafka åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„</a></li>
                    <li>
                        <a href="#2-kafka-%e5%8d%95%e6%9c%ba%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba-%e4%b8%8e-%e5%90%af%e5%8a%a8" aria-label="2. kafka å•æœºç¯å¢ƒæ­å»º ä¸ å¯åŠ¨">2. kafka å•æœºç¯å¢ƒæ­å»º ä¸ å¯åŠ¨</a><ul>
                            
                    <li>
                        <a href="#21-%e4%b8%8b%e8%bd%bdkafka%e5%ae%89%e8%a3%85%e5%8c%85%e4%b8%8a%e4%bc%a0%e6%9c%8d%e5%8a%a1%e5%99%a8" aria-label="2.1 ä¸‹è½½Kafkaå®‰è£…åŒ…ä¸Šä¼ æœåŠ¡å™¨">2.1 ä¸‹è½½Kafkaå®‰è£…åŒ…ä¸Šä¼ æœåŠ¡å™¨</a></li>
                    <li>
                        <a href="#22-%e9%85%8d%e7%bd%aezookeeper%e9%85%8d%e7%bd%ae" aria-label="2.2 é…ç½®zookeeperé…ç½®">2.2 é…ç½®zookeeperé…ç½®</a></li>
                    <li>
                        <a href="#23-%e9%85%8d%e7%bd%aekafka%e9%85%8d%e7%bd%aeserver" aria-label="2.3 é…ç½®kafkaé…ç½®ï¼ˆserverï¼‰">2.3 é…ç½®kafkaé…ç½®ï¼ˆserverï¼‰</a></li>
                    <li>
                        <a href="#24-%e5%90%8e%e5%8f%b0%e5%90%af%e5%8a%a8zookeeper%e5%b9%b6%e6%a3%80%e9%aa%8c%e6%98%af%e5%90%a6%e8%bf%90%e8%a1%8c%e6%88%90%e5%8a%9f" aria-label="2.4 åå°å¯åŠ¨zookeeperå¹¶æ£€éªŒæ˜¯å¦è¿è¡ŒæˆåŠŸ">2.4 åå°å¯åŠ¨zookeeperå¹¶æ£€éªŒæ˜¯å¦è¿è¡ŒæˆåŠŸ</a></li>
                    <li>
                        <a href="#25-%e5%90%8e%e5%8f%b0%e5%90%af%e5%8a%a8kafka" aria-label="2.5 åå°å¯åŠ¨kafka">2.5 åå°å¯åŠ¨kafka</a></li>
                    <li>
                        <a href="#26-%e5%88%9b%e5%bb%ba%e5%b9%b6%e6%9f%a5%e7%9c%8btopic" aria-label="2.6 åˆ›å»ºå¹¶æŸ¥çœ‹topic">2.6 åˆ›å»ºå¹¶æŸ¥çœ‹topic</a></li></ul>
                    </li>
                    <li>
                        <a href="#3-java%e5%ae%9e%e7%8e%b0-kafka-producer" aria-label="3. JAVAå®ç° Kafka Producer">3. JAVAå®ç° Kafka Producer</a><ul>
                            
                    <li>
                        <a href="#31-%e6%96%b9%e5%bc%8f%e4%b8%80kafka-clients" aria-label="3.1 æ–¹å¼ä¸€ï¼škafka-clients">3.1 æ–¹å¼ä¸€ï¼škafka-clients</a><ul>
                            
                    <li>
                        <a href="#%e5%bc%95%e5%85%a5kafka-clients%e4%be%9d%e8%b5%96" aria-label="å¼•å…¥kafka-clientsä¾èµ–">å¼•å…¥kafka-clientsä¾èµ–</a></li>
                    <li>
                        <a href="#%e5%88%9b%e5%bb%ba%e7%94%9f%e4%ba%a7%e8%80%85-kafkaproducer" aria-label="åˆ›å»ºç”Ÿäº§è€… KafkaProducer">åˆ›å»ºç”Ÿäº§è€… KafkaProducer</a></li>
                    <li>
                        <a href="#%e5%8f%91%e9%80%81%e6%b6%88%e6%81%af" aria-label="å‘é€æ¶ˆæ¯">å‘é€æ¶ˆæ¯</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#4-java%e5%ae%9e%e7%8e%b0-kafka-consumer" aria-label="4. JAVAå®ç° Kafka Consumer">4. JAVAå®ç° Kafka Consumer</a><ul>
                            
                    <li>
                        <a href="#41-%e6%96%b9%e5%bc%8f%e4%b8%80kaf%e7%99%bb%e5%bd%95%e6%96%87%e4%bb%b6%e6%8f%90%e4%ba%a4%e5%90%8e%e8%87%aa%e5%8a%a8%e9%87%8d%e5%91%bd%e5%90%8d%e6%94%af%e6%8c%81%e6%94%b6%e9%9b%86%e4%bb%bb%e6%84%8f%e6%a0%bc%e5%bc%8f%e6%96%87%e4%bb%b6" aria-label="4.1 æ–¹å¼ä¸€ï¼škafç™»å½•ï¼Œæ–‡ä»¶æäº¤åè‡ªåŠ¨é‡å‘½åï¼Œæ”¯æŒæ”¶é›†ä»»æ„æ ¼å¼æ–‡ä»¶ã€‚">4.1 æ–¹å¼ä¸€ï¼škafç™»å½•ï¼Œæ–‡ä»¶æäº¤åè‡ªåŠ¨é‡å‘½åï¼Œæ”¯æŒæ”¶é›†ä»»æ„æ ¼å¼æ–‡ä»¶ã€‚</a><ul>
                            
                    <li>
                        <a href="#%e5%bc%95%e5%85%a5kafka-clients%e4%be%9d%e8%b5%96-1" aria-label="å¼•å…¥kafka-clientsä¾èµ–">å¼•å…¥kafka-clientsä¾èµ–</a></li>
                    <li>
                        <a href="#%e5%88%9b%e5%bb%ba%e6%b6%88%e8%b4%b9%e8%80%85-kafkaconsumer" aria-label="åˆ›å»ºæ¶ˆè´¹è€… KafkaConsumer">åˆ›å»ºæ¶ˆè´¹è€… KafkaConsumer</a></li>
                    <li>
                        <a href="#%e8%ae%a2%e9%98%85%e4%b8%bb%e9%a2%98topic" aria-label="è®¢é˜…ä¸»é¢˜Topic">è®¢é˜…ä¸»é¢˜Topic</a></li>
                    <li>
                        <a href="#%e6%b6%88%e8%b4%b9%e8%bd%ae%e8%af%a2%e6%a0%b8%e5%bf%83" aria-label="æ¶ˆè´¹è½®è¯¢ï¼ˆæ ¸å¿ƒï¼‰">æ¶ˆè´¹è½®è¯¢ï¼ˆæ ¸å¿ƒï¼‰</a>
                    </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>


  <div class="post-content"><h1 id="kafka-å…¥é—¨æŒ‡å—">kafka å…¥é—¨æŒ‡å—<a hidden class="anchor" aria-hidden="true" href="#kafka-å…¥é—¨æŒ‡å—">#</a></h1>
<h2 id="1-kafka-åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„">1. kafka åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„<a hidden class="anchor" aria-hidden="true" href="#1-kafka-åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬æ¶æ„">#</a></h2>
<h2 id="2-kafka-å•æœºç¯å¢ƒæ­å»º-ä¸-å¯åŠ¨">2. kafka å•æœºç¯å¢ƒæ­å»º ä¸ å¯åŠ¨<a hidden class="anchor" aria-hidden="true" href="#2-kafka-å•æœºç¯å¢ƒæ­å»º-ä¸-å¯åŠ¨">#</a></h2>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/CSDN877425287/article/details/108836682">https://blog.csdn.net/CSDN877425287/article/details/108836682</a></li>
<li><a href="https://www.cnblogs.com/qpf1/p/9161742.html">https://www.cnblogs.com/qpf1/p/9161742.html</a></li>
</ol>
<p>æ‰©å±•ï¼ˆkafkaç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—ï¼‰:</p>
<p><a href="https://xie.infoq.cn/article/d57f83779490c7ff62b6b59ae">kafkaç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—</a></p>
<h3 id="21-ä¸‹è½½kafkaå®‰è£…åŒ…ä¸Šä¼ æœåŠ¡å™¨">2.1 ä¸‹è½½Kafkaå®‰è£…åŒ…ä¸Šä¼ æœåŠ¡å™¨<a hidden class="anchor" aria-hidden="true" href="#21-ä¸‹è½½kafkaå®‰è£…åŒ…ä¸Šä¼ æœåŠ¡å™¨">#</a></h3>
<p><a href="https://kafka.apache.org/downloads">kafkaå®˜ç½‘</a></p>
<p><img loading="lazy" src="https://zzp-note.oss-cn-hangzhou.aliyuncs.com/image/image-20221116231239045.png" alt="image-20221116231239045"  />
</p>
<p>scp æŒ‡ä»¤ä¸Šä¼ æœåŠ¡å™¨</p>
<p><code>tar xzvf kafka_2.12-2.1.0.tgz -C /home/ubuntu/environments</code></p>
<h3 id="22-é…ç½®zookeeperé…ç½®">2.2 é…ç½®zookeeperé…ç½®<a hidden class="anchor" aria-hidden="true" href="#22-é…ç½®zookeeperé…ç½®">#</a></h3>
<p>æ— éœ€å•ç‹¬ä¸‹è½½ï¼Œå·²ç»é›†æˆ</p>
<p><code>vim ./kafka_2.12-2.1.0/config/zookeeper.properties</code></p>
<p>å¦‚æœkafkaå’Œzkæ˜¯å•èŠ‚ç‚¹è¿è¡Œçš„è¯ä½¿ç”¨kafkaçš„é»˜è®¤é…ç½®å³å¯</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#é›†ç¾¤é…ç½®-å•èŠ‚ç‚¹æ— éœ€é…ç½®
</span></span><span style="display:flex;"><span>server.1=192.168.0.187:2888:3888
</span></span><span style="display:flex;"><span>server.2=192.168.0.188:2888:3888
</span></span><span style="display:flex;"><span>server.3=192.168.0.189:2888:3888
</span></span></code></pre></div><p><img loading="lazy" src="https://zzp-note.oss-cn-hangzhou.aliyuncs.com/image/image-20221116232713399.png" alt="image-20221116232713399"  />
</p>
<p><strong><code>dataDir</code> zkæ•°æ®å­˜æ”¾ç›®å½•</strong></p>
<p><code>dataLogDir</code> zkæ—¥å¿—å­˜æ”¾ç›®å½•</p>
<p><strong><code>clientPort</code> å®¢æˆ·ç«¯è¿æ¥zkæœåŠ¡çš„ç«¯å£</strong></p>
<p><code>tickTime</code> zkæœåŠ¡å™¨ä¹‹é—´æˆ–è€…å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”</p>
<p><code>initLimit</code> å…è®¸followerï¼ˆç›¸å¯¹äºLeadererè¨€çš„ï¼Œå®¢æˆ·ç«¯ï¼‰è¿æ¥å¹¶åŒæ­¥åˆ°Leaderçš„åˆå§‹åŒ–è¿æ¥æ—¶é—´ï¼Œä»¥tickTimeä¸ºå•ä½ï¼Œå½“åˆå§‹åŒ–è¿æ¥æ—¶é—´è¶…è¿‡è¯¥å€¼ï¼Œåˆ™è¡¨ç¤ºè¿æ¥å¤±è´¥ã€‚</p>
<p><code>syncLimit</code> LeaderäºFollowerä¹‹é—´å‘é€æ¶ˆæ¯æ—¶ï¼Œè¯·æ±‚å’Œç­”åº”æ—¶é—´é•¿åº¦ï¼Œå¦‚æœfollowåœ¨è®¾ç½®æ—¶é—´å†…ä¸èƒ½ä¸leaderé€šä¿¡ï¼Œé‚£ä¹ˆæ­¤followerå°†ä¼šè¢«ä¸¢å¼ƒ</p>
<p><code>server.1=192.168.0.187:2888:3888</code> 2888æ˜¯followeräºleaderå‡ç¼“ä¿¡æ¯çš„ç«¯å£ï¼Œ3888å½“leaderäº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼Œ3888æ˜¯å½“leaderæŒ‚äº†æ—¶ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ˜¯æœåŠ¡å™¨äº’ç›¸é€šä¿¡çš„ç«¯å£</p>
<h3 id="23-é…ç½®kafkaé…ç½®server">2.3 é…ç½®kafkaé…ç½®ï¼ˆserverï¼‰<a hidden class="anchor" aria-hidden="true" href="#23-é…ç½®kafkaé…ç½®server">#</a></h3>
<p><strong>å¦‚æœkafkaå’Œzkæ˜¯å•èŠ‚ç‚¹è¿è¡Œçš„è¯ä½¿ç”¨kafkaçš„é»˜è®¤é…ç½®å³å¯</strong></p>
<p>å…³é”®ï¼š</p>
<p><strong>log.dirså’Œzookeeper.connectã€‚å‰è€…æ˜¯æ—¥å¿—å­˜æ”¾æ–‡ä»¶å¤¹ï¼Œåè€…æ˜¯zookeeperè¿æ¥åœ°å€ï¼ˆç«¯å£å’ŒclientPortä¿æŒä¸€è‡´ï¼‰ã€‚</strong></p>
<ul>
<li><strong>listeners</strong></li>
<li><strong>advertised.listeners</strong>ï¼ˆå¯¹å¤–å®£æ‰¬/æš´éœ²çš„åœ°å€å’Œç«¯å£ï¼Œæ¯”å¦‚å¯¹ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æš´éœ²ï¼‰</li>
</ul>
<p>åœ¨å…¬å¸å†…ç½‘éƒ¨ç½² kafka é›†ç¾¤åªéœ€è¦ç”¨åˆ° listenersï¼Œå†…å¤–ç½‘éœ€è¦ä½œåŒºåˆ†æ—¶ æ‰éœ€è¦ç”¨åˆ°advertised.listenersã€‚</p>
<p>advertised_listeners ç›‘å¬å™¨ä¼šæ³¨å†Œåœ¨ zookeeper ä¸­ï¼›</p>
<p>å½“æˆ‘ä»¬å¯¹ 172.17.0.10:9092 è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œkafka æœåŠ¡å™¨ä¼šé€šè¿‡ zookeeper ä¸­æ³¨å†Œçš„ç›‘å¬å™¨ï¼Œæ‰¾åˆ° INSIDE ç›‘å¬å™¨ï¼Œç„¶åé€šè¿‡ listeners ä¸­æ‰¾åˆ°å¯¹åº”çš„ é€šè®¯ ip å’Œ ç«¯å£ï¼›</p>
<p>åŒç†ï¼Œå½“æˆ‘ä»¬å¯¹ &lt;å…¬ç½‘ ip&gt;:ç«¯å£ è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œkafka æœåŠ¡å™¨ä¼šé€šè¿‡ zookeeper ä¸­æ³¨å†Œçš„ç›‘å¬å™¨ï¼Œæ‰¾åˆ° OUTSIDE ç›‘å¬å™¨ï¼Œç„¶åé€šè¿‡ listeners ä¸­æ‰¾åˆ°å¯¹åº”çš„ é€šè®¯ ip å’Œ ç«¯å£ 172.17.0.10:9094ï¼›</p>
<p>æ€»ç»“ï¼šadvertised_listeners æ˜¯å¯¹å¤–æš´éœ²çš„æœåŠ¡ç«¯å£ï¼ŒçœŸæ­£å»ºç«‹è¿æ¥ç”¨çš„æ˜¯ listenersã€‚</p>
<ul>
<li>åªæœ‰å†…ç½‘ï¼Œæ¯”å¦‚åœ¨å…¬å¸æ­å»ºçš„ kafka é›†ç¾¤ï¼Œåªæœ‰å†…ç½‘ä¸­çš„æœåŠ¡å¯ä»¥ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è¦ç”¨ listeners å°±è¡Œã€‚</li>
<li>å†…å¤–ç½‘ï¼Œæ¯”å¦‚åœ¨ docker ä¸­æˆ–è€… åœ¨ç±»ä¼¼é˜¿é‡Œäº‘ä¸»æœºä¸Šéƒ¨ç½² kafka é›†ç¾¤ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ éœ€è¦ç”¨åˆ° advertised_listeners</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>broker.id=0									æ¯ä¸ªserveréœ€è¦å•ç‹¬é…ç½®broker.idå¦‚æœä¸é…ç½®ç³»ç»Ÿä¼šæŒ‡å®šé…ç½®ï¼Œéœ€è¦å’Œä¸Šä¸€æ­¥IDä¸€è‡´
</span></span><span style="display:flex;"><span>listeners=PLAINTEST://ip:9092				ç›‘å¬åœ°å€ï¼Œæ ¼å¼PLAINTESTï¼š//ipï¼šç«¯å£
</span></span><span style="display:flex;"><span>num.network.threads=3						æ¥æ”¶å’Œå‘é€ç½‘ç»œä¿¡æ¯çš„çº¿ç¨‹æ•°
</span></span><span style="display:flex;"><span>num.io.threads=8							æœåŠ¡å™¨ç”¨äºå¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ•°ï¼Œå…¶ä¸­å¯èƒ½åŒ…æ‹¬ç£ç›˜IO
</span></span><span style="display:flex;"><span>socket.send.buffer.bytes=102400				å¥—æ¥å­—æœåŠ¡å™¨ä½¿ç”¨çš„å‘é€ç¼“å†²åŒºï¼ˆSO_SNDBUFï¼‰
</span></span><span style="display:flex;"><span>socket.receive.buffer.bytes=102400			å¥—æ¥å­—æœåŠ¡å™¨ä½¿ç”¨çš„æ¥æ”¶ç¼“å†²åŒºï¼ˆSO_RCVBUFï¼‰
</span></span><span style="display:flex;"><span>socket.request.max.bytes=104857600			å¥—æ¥å­—æœåŠ¡å™¨å°†æ¥æ”¶çš„è¯·æ±‚æœ€å¤§å¤§å°ï¼ˆé˜²æ­¢OOMï¼‰
</span></span><span style="display:flex;"><span>log.dirs=/tmp/kafka-logs					æ—¥å¿—æ–‡ä»¶
</span></span><span style="display:flex;"><span>num.partitions=1							partitionsçš„æ•°é‡
</span></span><span style="display:flex;"><span>num.recovery.threads.per.data.dir=1			å¯åŠ¨æ—¶æ¢å¤æ—¥å¿—ï¼Œå…³é—­æ—¶åˆ·ç›˜æ—¥å¿—æ¯ä¸ªæ•°æ®ç›®å½•çš„çº¿ç¨‹çš„æ•°é‡ï¼Œé»˜è®¤1
</span></span><span style="display:flex;"><span>offsets.topic.replication.factor=1			åç§»é‡è¯é¢˜çš„å¤åˆ¶å› å­ï¼ˆè®¾ç½®æ›´é«˜ä¿è¯å¯ç”¨ï¼‰ï¼Œä¸ºä¿è¯æœ‰æ•ˆçš„çˆ¶å­ï¼Œåç§»é‡çš„å¤åˆ¶å› å­æ˜¯å¯é…ç½®çš„ï¼Œåœ¨åç§»è¯é¢˜çš„ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™å¯ç”¨borkerçš„æ•°é‡è‡³å°‘ä¸ºå¤åˆ¶å› å­çš„å¤§å°ï¼Œå¦åˆ™è¦ä¹ˆè¯é¢˜åˆ›å»ºå¤±è´¥ï¼Œè¦ä¹ˆå¤åˆ¶å› å­å–å¯ç”¨çš„æ•°é‡å’Œé…ç½®å¤åˆ¶å› å­å–æœ€å°å€¼
</span></span><span style="display:flex;"><span>transaction.state.log.replication.factor=1
</span></span><span style="display:flex;"><span>transaction.state.log.min.isr=1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log.retention.hours=168						æ—¥å¿—æ–‡ä»¶åˆ é™¤ä¹‹å‰ä¿ç•™çš„æ—¶é—´
</span></span><span style="display:flex;"><span>log.segment.bytes=1073741824				å•ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°é»˜è®¤ä¸º1073741824
</span></span><span style="display:flex;"><span>log.retention.check.interval.ms=300000		æ£€æŸ¥æ—¥å¿—ç«¯ä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥æ ¹æ®ä¿ç•™ç­–ç•¥åˆ é™¤ä»–ä»¬çš„æ—¶é—´é³„æ¢¨
</span></span><span style="display:flex;"><span>zookeeper.connect=zkip:2181					zkä¸»æœºåœ°å€ï¼Œå¦‚æœæ˜¯zké›†ç¾¤ä»¥é€—å·åˆ†éš”
</span></span><span style="display:flex;"><span>zookeeper.connection.timeout.ms=6000		è¿æ¥zkçš„è¶…æ—¶æ—¶é—´
</span></span><span style="display:flex;"><span>group.initial.rebalance.delay.ms=0
</span></span></code></pre></div><h3 id="24-åå°å¯åŠ¨zookeeperå¹¶æ£€éªŒæ˜¯å¦è¿è¡ŒæˆåŠŸ">2.4 åå°å¯åŠ¨zookeeperå¹¶æ£€éªŒæ˜¯å¦è¿è¡ŒæˆåŠŸ<a hidden class="anchor" aria-hidden="true" href="#24-åå°å¯åŠ¨zookeeperå¹¶æ£€éªŒæ˜¯å¦è¿è¡ŒæˆåŠŸ">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">cd</span> kafka_2.12-2.1.0/
</span></span><span style="display:flex;"><span>nohup bin/zookeeper-server-start.sh config/zookeeper.properties &amp;
</span></span><span style="display:flex;"><span>nohup bin/zookeeper-server-start.sh config/zookeeper.properties &gt; zookeeper-run.log 2&gt;&amp;<span style="color:#ff0;font-weight:bold">1</span> &amp;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> conf | nc localhost <span style="color:#ff0;font-weight:bold">2181</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> stat | nc localhost <span style="color:#ff0;font-weight:bold">2181</span>
</span></span></code></pre></div><p><img loading="lazy" src="https://zzp-note.oss-cn-hangzhou.aliyuncs.com/image/image-20221116234427027.png" alt="image-20221116234427027"  />
</p>
<h3 id="25-åå°å¯åŠ¨kafka">2.5 åå°å¯åŠ¨kafka<a hidden class="anchor" aria-hidden="true" href="#25-åå°å¯åŠ¨kafka">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>nohup bin/kafka-server-start.sh config/server.properties &gt; kafka-run.log 2&gt;&amp;<span style="color:#ff0;font-weight:bold">1</span> &amp;
</span></span></code></pre></div><h3 id="26-åˆ›å»ºå¹¶æŸ¥çœ‹topic">2.6 åˆ›å»ºå¹¶æŸ¥çœ‹topic<a hidden class="anchor" aria-hidden="true" href="#26-åˆ›å»ºå¹¶æŸ¥çœ‹topic">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ubuntu$&gt; ./bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor <span style="color:#ff0;font-weight:bold">1</span> --partitions <span style="color:#ff0;font-weight:bold">1</span> --topic <span style="color:#fff;font-weight:bold">test</span>
</span></span><span style="display:flex;"><span>Created topic <span style="color:#0ff;font-weight:bold">&#34;test&#34;</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ubuntu$&gt; ./bin/kafka-topics.sh --zookeeper localhost:2181 --list
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">test</span>
</span></span></code></pre></div><h2 id="3-javaå®ç°-kafka-producer">3. JAVAå®ç° Kafka Producer<a hidden class="anchor" aria-hidden="true" href="#3-javaå®ç°-kafka-producer">#</a></h2>
<h3 id="31-æ–¹å¼ä¸€kafka-clients">3.1 æ–¹å¼ä¸€ï¼škafka-clients<a hidden class="anchor" aria-hidden="true" href="#31-æ–¹å¼ä¸€kafka-clients">#</a></h3>
<p>APIå‚è€ƒï¼šhttps://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html</p>
<p>ç”Ÿäº§è€…è¯¦è§£ã€è¿›é˜¶å‚è€ƒï¼šhttps://www.jianshu.com/p/37ea14d1d4abï¼ˆä¸»è¦åŒ…å«ç”Ÿäº§è€…å‚æ•°é…ç½®ã€æ¶ˆæ¯åºåˆ—åŒ–ã€è‡ªå®šä¹‰åˆ†åŒºï¼‰</p>
<h4 id="å¼•å…¥kafka-clientsä¾èµ–">å¼•å…¥kafka-clientsä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#å¼•å…¥kafka-clientsä¾èµ–">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.apache.kafka<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>kafka-clients<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>2.1.0<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h4 id="åˆ›å»ºç”Ÿäº§è€…-kafkaproducer">åˆ›å»ºç”Ÿäº§è€… KafkaProducer<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºç”Ÿäº§è€…-kafkaproducer">#</a></h4>
<p><code>KafkaProducer</code> API: <a href="https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html">https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html</a></p>
<p>å‘ Kafka å†™å…¥æ¶ˆæ¯ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ‰3ä¸ªå¿…è¦å±æ€§ã€‚</p>
<ul>
<li><code>bootstrap.servers</code>
æŒ‡å®š broker çš„åœ°å€åˆ—è¡¨ï¼Œåœ°å€çš„æ ¼å¼ä¸º <code>host:port</code>ã€‚
ä¸éœ€è¦åŒ…å«æ‰€æœ‰çš„ broker åœ°å€ï¼Œç”Ÿäº§è€…ä¼šé€šè¿‡ç»™å®šçš„ broker æŸ¥æ‰¾åˆ°å…¶ä»– broker çš„ä¿¡æ¯ã€‚å»ºè®®è‡³å°‘æä¾›ä¸¤ä¸ª broker çš„ä¿¡æ¯ï¼Œé˜²æ­¢å…¶ä¸­ä¸€ä¸ªå®•æœºã€‚</li>
<li><code>key.serializer</code>
Kafka å®¢æˆ·ç«¯é»˜è®¤æä¾›äº† <code>ByteArraySerializer</code>ã€ <code>StringSerializer</code> å’Œ <code>IntegerSerializer</code>ï¼Œå› æ­¤å¦‚æœä½¿ç”¨å¸¸è§çš„ Java å¯¹è±¡ç±»å‹ï¼Œä¸éœ€è¦å®ç°è‡ªå·±çš„åºåˆ—åŒ–å™¨ ã€‚å¦‚æœè¦è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼Œéœ€è¦å®ç° <code>org.apache.kafka.common.serialization.Serializer</code> æ¥å£ã€‚
éœ€è¦æ³¨æ„ï¼Œkey.serializer æ˜¯å¿…é¡»è®¾ç½®çš„ï¼Œå³ä½¿åªå‘é€å€¼ç±»å‹ã€‚</li>
<li><code>value.serializer</code>
ä¸ <code>key.serializer</code> ä¸€æ ·ï¼Œ <code>value.serializer</code> æŒ‡å®šçš„ç±»ä¼šå°†å€¼åºåˆ—åŒ–å‘é€ç»™ brokerã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        Properties kafkaProps = <span style="color:#fff;font-weight:bold">new</span> Properties();
</span></span><span style="display:flex;"><span>        kafkaProps.<span style="color:#007f7f">put</span>(ProducerConfig.<span style="color:#007f7f">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#0ff;font-weight:bold">&#34;kafka-broker-ip:9092&#34;</span>);
</span></span><span style="display:flex;"><span>        kafkaProps.<span style="color:#007f7f">put</span>(ProducerConfig.<span style="color:#007f7f">KEY_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        kafkaProps.<span style="color:#007f7f">put</span>(ProducerConfig.<span style="color:#007f7f">VALUE_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        KafkaProducer&lt;String, String&gt; producer = <span style="color:#fff;font-weight:bold">new</span> KafkaProducer&lt;String, String&gt;(kafkaProps);
</span></span></code></pre></div><h4 id="å‘é€æ¶ˆæ¯">å‘é€æ¶ˆæ¯<a hidden class="anchor" aria-hidden="true" href="#å‘é€æ¶ˆæ¯">#</a></h4>
<p>å®ä¾‹åŒ–ç”Ÿäº§è€…å¯¹è±¡åï¼Œå°±å¯ä»¥å¼€å§‹é€æ¶ˆæ¯äº†ã€‚å‘é€æ¶ˆæ¯ä¸»è¦æœ‰ä»¥ä¸‹ 3 ç§æ–¹å¼ï¼š</p>
<ul>
<li>å‘é€å¹¶å¿˜è®°ï¼ˆfire-and-forgetï¼‰
æŠŠæ¶ˆæ¯å‘é€ç»™æœåŠ¡å™¨ï¼Œä¸å…³å¿ƒæ˜¯å¦æ­£å¸¸åˆ°è¾¾ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯ä¼šæ­£å¸¸åˆ°è¾¾ï¼Œå› ä¸º  Kafka æ˜¯é«˜å¯ç”¨çš„ï¼Œè€Œä¸”ç”Ÿäº§è€…ä¼šè‡ªåŠ¨å°è¯•é‡å‘ã€‚ä¸è¿‡ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æœ‰æ—¶å€™ä¹Ÿä¼šä¸¢å¤±ä¸€äº›æ¶ˆæ¯ã€‚</li>
<li>åŒæ­¥å‘é€ï¼ˆasyncï¼‰
ä½¿ç”¨ <code>send()</code> æ–¹æ³•å‘é€æ¶ˆæ¯ï¼Œä¼šè¿”å›ä¸€ä¸ª Future å¯¹è±¡ï¼Œè°ƒç”¨ get() æ–¹æ³•é˜»å¡ç­‰å¾…è¿”å›ï¼Œè¿”å›ç»“æœçŸ¥é“æ˜¯å¦å‘é€æˆåŠŸã€‚</li>
<li><strong>å¼‚æ­¥å‘é€ï¼ˆsyncï¼‰</strong>ï¼ˆæœ€ç®€å•æœ€å¸¸ç”¨ï¼‰
ä½¿ç”¨ <code>send()</code> æ–¹æ³•å¹¶æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ŒæœåŠ¡å™¨åœ¨è¿”å›å“åº”æ—¶è°ƒç”¨è¯¥å‡½æ•°ã€‚</li>
</ul>
<p>æ ¸å¿ƒå¯¹è±¡ï¼š</p>
<ul>
<li>æ¶ˆæ¯å¯¹è±¡ <code>ProducerRecord</code> : <a href="https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html">https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html</a></li>
<li>æ¶ˆæ¯è®°å½•çš„å­˜å‚¨ä¿¡æ¯ <code>RecordMetadata</code>ï¼š <a href="https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html">https://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html</a>ï¼ˆ<code>send(...).get()</code>è¿”å›å¯¹è±¡ï¼‰</li>
</ul>
<p>ä¾‹å­ä½¿ç”¨äº†ScheduledExecutorServiveï¼ˆå³ScheduledThreadPoolï¼‰æ¥è¿›è¡Œå®šæ—¶ä»»åŠ¡</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        ScheduledExecutorService scheduledExecutor = Executors.<span style="color:#007f7f">newScheduledThreadPool</span>(<span style="color:#ff0;font-weight:bold">5</span>);
</span></span><span style="display:flex;"><span>        scheduledExecutor.<span style="color:#007f7f">scheduleAtFixedRate</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                RecordMetadata recordMetadata = producer.<span style="color:#007f7f">send</span>(<span style="color:#fff;font-weight:bold">new</span> ProducerRecord&lt;String, String&gt;(<span style="color:#0ff;font-weight:bold">&#34;test&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;time&#34;</span>, <span style="color:#fff;font-weight:bold">new</span> Date().<span style="color:#007f7f">toString</span>())).<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;Success: OFFSET-&#34;</span>+recordMetadata.<span style="color:#007f7f">offset</span>());
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ERROR&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (ExecutionException e) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;ERROR&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">2</span>, TimeUnit.<span style="color:#007f7f">SECONDS</span>);
</span></span></code></pre></div><h2 id="4-javaå®ç°-kafka-consumer">4. JAVAå®ç° Kafka Consumer<a hidden class="anchor" aria-hidden="true" href="#4-javaå®ç°-kafka-consumer">#</a></h2>
<h3 id="41-æ–¹å¼ä¸€kafç™»å½•æ–‡ä»¶æäº¤åè‡ªåŠ¨é‡å‘½åæ”¯æŒæ”¶é›†ä»»æ„æ ¼å¼æ–‡ä»¶">4.1 æ–¹å¼ä¸€ï¼škafç™»å½•ï¼Œæ–‡ä»¶æäº¤åè‡ªåŠ¨é‡å‘½åï¼Œæ”¯æŒæ”¶é›†ä»»æ„æ ¼å¼æ–‡ä»¶ã€‚<a hidden class="anchor" aria-hidden="true" href="#41-æ–¹å¼ä¸€kafç™»å½•æ–‡ä»¶æäº¤åè‡ªåŠ¨é‡å‘½åæ”¯æŒæ”¶é›†ä»»æ„æ ¼å¼æ–‡ä»¶">#</a></h3>
<p>æ­é…åšæœäº‘ka-clients</p>
<p>API å‚è€ƒï¼šhttps://kafka.apache.org/33/javadoc/org/apache/kafka/clients/consumer/package-frame.html</p>
<p>æ¶ˆè´¹è€…è¯¦è§£ã€è¿›é˜¶å‚è€ƒï¼šhttps://www.jianshu.com/p/1f9e18e926f6ï¼ˆä¸»è¦åŒ…æ‹¬æ¶ˆè´¹è€…å‚æ•°é…ç½®</p>
<h4 id="å¼•å…¥kafka-clientsä¾èµ–-1">å¼•å…¥kafka-clientsä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#å¼•å…¥kafka-clientsä¾èµ–-1">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.apache.kafka<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>kafka-clients<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;version&gt;</span>2.1.0<span style="font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h4 id="åˆ›å»ºæ¶ˆè´¹è€…-kafkaconsumer">åˆ›å»ºæ¶ˆè´¹è€… KafkaConsumer<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºæ¶ˆè´¹è€…-kafkaconsumer">#</a></h4>
<ul>
<li>KafkaConsumerå¯¹è±¡APIï¼šhttps://kafka.apache.org/33/javadoc/index.html?org/apache/kafka/clients/consumer/KafkaConsumer.html</li>
<li>ConsumerConfig APIï¼šhttps://kafka.apache.org/33/javadoc/org/apache/kafka/clients/consumer/ConsumerConfig.html</li>
</ul>
<p><strong>auto.offset.reset</strong>ï¼šå½“ä¸å­˜åœ¨åˆå§‹åç§»é‡æˆ–æœåŠ¡å™¨ä¸Šä¸å†å­˜åœ¨å½“å‰åç§»é‡æ—¶ï¼Œæ­¤å±æ€§æ˜¯å¿…éœ€çš„ã€‚åªæœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼å¯ç”¨äºé‡ç½®åç§»å€¼ï¼š</p>
<p>What to do when there is no initial offset in Kafka or if the current offset does not exist any more on the server (e.g. because that data has been deleted):</p>
<ul><li>earliest: automatically reset the offset to the earliest offset<li>latest: automatically reset the offset to the latest offset</li><li>none: throw exception to the consumer if no previous offset is found for the consumer\'s group</li><li>anything else: throw exception to the consumer.</li></ul>
<p>æŒ‡å®šäº†æ¶ˆè´¹è€…åœ¨è¯»å–ä¸€ä¸ªæ²¡æœ‰åç§»é‡ï¼ˆoffsetï¼‰çš„åˆ†åŒºæˆ–è€…åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹ï¼ˆå› æ¶ˆè´¹è€…é•¿æ—¶é—´å¤±æ•ˆï¼ŒåŒ…å«åç§»é‡çš„è®°å½•å·²ç»è¿‡æ—¶äº•è¢«åˆ é™¤ï¼‰è¯¥ä½œä½•å¤„ç†ï¼Œ<strong>é»˜è®¤å€¼æ˜¯ <code>latest</code>ï¼Œè¡¨ç¤ºåœ¨ offset æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å°†ä»æœ€æ–°çš„è®°å½•å¼€å§‹è¯»å–æ•°æ®ï¼ˆåœ¨æ¶ˆè´¹è€…å¯åŠ¨ä¹‹åç”Ÿæˆçš„è®°å½•ï¼‰</strong>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        Properties props = <span style="color:#fff;font-weight:bold">new</span> Properties();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">put</span>(ConsumerConfig.<span style="color:#007f7f">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#0ff;font-weight:bold">&#34;124.222.233.153:9092&#34;</span>);
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">put</span>(ConsumerConfig.<span style="color:#007f7f">GROUP_ID_CONFIG</span>, <span style="color:#0ff;font-weight:bold">&#34;191870267-0&#34;</span>);
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">put</span>(ConsumerConfig.<span style="color:#007f7f">KEY_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">put</span>(ConsumerConfig.<span style="color:#007f7f">VALUE_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#007f7f">class</span>.<span style="color:#007f7f">getName</span>());
</span></span><span style="display:flex;"><span>		props.<span style="color:#007f7f">put</span>(ConsumerConfig.<span style="color:#007f7f">AUTO_OFFSET_RESET_CONFIG</span>, <span style="color:#0ff;font-weight:bold">&#34;earliest&#34;</span>);
</span></span><span style="display:flex;"><span>        props.<span style="color:#007f7f">put</span>(ConsumerConfig.<span style="color:#007f7f">MAX_POLL_RECORDS_CONFIG</span>, <span style="color:#0ff;font-weight:bold">&#34;10&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        KafkaConsumer&lt;String, String&gt; consumer = <span style="color:#fff;font-weight:bold">new</span> KafkaConsumer&lt;String, String&gt;(props);
</span></span></code></pre></div><h4 id="è®¢é˜…ä¸»é¢˜topic">è®¢é˜…ä¸»é¢˜Topic<a hidden class="anchor" aria-hidden="true" href="#è®¢é˜…ä¸»é¢˜topic">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>consumer.<span style="color:#007f7f">subscribe</span>(Collections.<span style="color:#007f7f">singleton</span>(<span style="color:#0ff;font-weight:bold">&#34;test&#34;</span>));
</span></span></code></pre></div><h4 id="æ¶ˆè´¹è½®è¯¢æ ¸å¿ƒ">æ¶ˆè´¹è½®è¯¢ï¼ˆæ ¸å¿ƒï¼‰<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆè´¹è½®è¯¢æ ¸å¿ƒ">#</a></h4>
<p>æ¶ˆæ¯è½®è¯¢æ˜¯æ¶ˆè´¹è€…çš„æ ¸å¿ƒï¼Œé€šè¿‡è½®è¯¢å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚æ¶ˆæ¯è½®è¯¢ API ä¼šå¤„ç†æ‰€æœ‰çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬ç¾¤ç»„åè°ƒã€åˆ†åŒºå†å‡è¡¡ã€å‘é€å¿ƒè·³å’Œè·å–æ•°æ®ï¼Œå¼€å‘è€…åªéœ€è¦å¤„ç†ä»åˆ†åŒºè¿”å›çš„æ•°æ®ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (<span style="color:#fff;font-weight:bold">true</span>) {
</span></span><span style="display:flex;"><span>            ConsumerRecords&lt;String, String&gt; records = consumer.<span style="color:#007f7f">poll</span>(Duration.<span style="color:#007f7f">ofSeconds</span>(<span style="color:#ff0;font-weight:bold">5</span>));
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span>(ConsumerRecord&lt;String, String&gt; record : records) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;{offset=&#34;</span> + record.<span style="color:#007f7f">offset</span>() + <span style="color:#0ff;font-weight:bold">&#34; , key=&#34;</span> + record.<span style="color:#007f7f">key</span>() + <span style="color:#0ff;font-weight:bold">&#34; , value=&#34;</span> + record.<span style="color:#007f7f">value</span>() + <span style="color:#0ff;font-weight:bold">&#34; , timestamp=&#34;</span> + record.<span style="color:#007f7f">timestamp</span>() + <span style="color:#0ff;font-weight:bold">&#34; }&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://124.222.233.153/tags/kafka/">kafka</a></li>
    </ul>

  </footer>
<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">ğŸ’¬ Comments</span>
        <hr />
    </div>
    <div id="tcomment"></div>
    <script src="https://cdn.staticfile.org/twikoo/1.6.10/twikoo.all.min.js"></script>
    <script>
        twikoo.init({
            envId: "https://twikoo-for-river-blog.vercel.app",  
            el: "#tcomment",
            lang: 'zh-CN',
            
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        });
    </script>
</div>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="http://124.222.233.153/">River&#39;s BLOG</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
